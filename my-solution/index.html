<!DOCTYPE html>
<html lang="en">

<head>
  <link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="style.css">
  <title>Civil War | Tic Tac Toe</title>
</head>

<body>
  
  <section>

    <header> 
      <div id="player">It's 
        <span style="color: #C31010; font-size: 25px">Captain America's </span>
        turn</div>
      <div id="scoreboard">0 - 0</div>
      <img src="images/cap-ame-shield.png" id="cap-ame" alt="Cap America" width="30px" height="30px">
      <img src="images/ir-man-head.png" id="ir-man" alt="Iron Man" width="30px" height="30px">
    </header>

    <div class="main">
        <div class="square players" id="pos1">a</div>
        <div class="square players" id="pos2">a</div>
        <div class="square players" id="pos3">a</div>
        <div class="square players" id="pos4">a</div>
        <div class="square players" id="pos5">a</div>
        <div class="square players" id="pos6">a</div>
        <div class="square players" id="pos7">a</div>
        <div class="square players" id="pos8">a</div>
        <div class="square players" id="pos9">a</div>
    </div>

    <footer>
      <button id="resetButton">Start New Battle!!!</button>
    </footer>

  </section>

</body>

<script> 


var matrix = [["", "", ""],["", "", ""],["", "", ""]];
alert("Hi! Let's play some Civil War - Tic Tac Toe. Captain America goes first. Good luck!");
var player = "X";
var winnerX = 0;
var winnerO = 0;


function squareClicked () {
  var squares = document.getElementsByClassName("square");
  squares[0].addEventListener("click", playerChoice);
  squares[1].addEventListener("click", playerChoice);
  squares[2].addEventListener("click", playerChoice);
  squares[3].addEventListener("click", playerChoice);
  squares[4].addEventListener("click", playerChoice);
  squares[5].addEventListener("click", playerChoice);
  squares[6].addEventListener("click", playerChoice);
  squares[7].addEventListener("click", playerChoice);
  squares[8].addEventListener("click", playerChoice);
  // for (var i=0; i<squares.length; i++) {
  //     squares[i].addEventListener("click", playerChoice);
}
squareClicked();


function playerChoice () {
    var position = this.getAttribute("id");
    if (player === "X") {
      switch (position) {
        case "pos1":
          matrix[0][0] = "X";
          break;
        case "pos2":
          matrix[0][1] = "X";
          break;
        case "pos3":
          matrix[0][2] = "X";
          break;
        case "pos4":
          matrix[1][0] = "X";
          break;
        case "pos5":
          matrix[1][1] = "X";
          break;
        case "pos6":
          matrix[1][2] = "X";
          break;
        case "pos7":
          matrix[2][0] = "X";
          break;
        case "pos8":
          matrix[2][1] = "X";
          break;
        case "pos9":
          matrix[2][2] = "X";
          break;
      }
    }
    else {
      switch (position) {
        case "pos1":
          matrix[0][0] = "O";
          break;
        case "pos2":
          matrix[0][1] = "O";
          break;
        case "pos3":
          matrix[0][2] = "O";
          break;
        case "pos4":
          matrix[1][0] = "O";
          break;
        case "pos5":
          matrix[1][1] = "O";
          break;
        case "pos6":
          matrix[1][2] = "O";
          break;
        case "pos7":
          matrix[2][0] = "O";
          break;
        case "pos8":
          matrix[2][1] = "O";
          break;
        case "pos9":
          matrix[2][2] = "O";
          break;
      }
    }
    this.setAttribute("style", "color: rgba(0,0,0,0.1)");
    this.style.fontSize = "5px";
    this.removeEventListener("click", playerChoice);
    var playerTurn = document.getElementById("player");
    if (player === "X"){
        this.setAttribute("style", "background-image: url(images/captain-america.png");
        playerTurn.textContent = "It's Iron Man's turn";
        player = "O";
    }
    else {
      this.setAttribute("style", "background-image: url(images/iron-man.jpg");
      playerTurn.textContent = "It's Captain America's turn";
      player = "X";
    }
    var winner = whoWon();
    if (winner === "X" || winner === "O") {

        if (winner === "X") {
          alert("Captain America wins!!");   
          winnerX ++;
        }
        else {
          alert("Iron Man wins!!");
          winnerO ++;   
        }
        clearSquares();        
    }
    else {
        console.log("Not yet a Winner");
    }
    checkThreeWinsRow();
}

function checkThreeWinsRow (winner) {
  if (winnerX >= 3) {
    if (winnerO === 0) {
      alert("Captain America wins 3 in a row!!!");
      winnerX = 0;
      winnerO = 0;
      clearSquares();  
    }
  }
  else if (winnerO >= 3 ) { 
    if(winnerX === 0) {
      alert("Iron Man wins 3 in a row!!!");
      winnerX = 0;
      winnerO = 0;
      clearSquares();  
    }
  }
}

function whoWon () {
  if (matrix[0][0] === "X" &&matrix[0][1] === "X" && matrix[0][2] === "X") {
    return "X";
  }
  else if (matrix[1][0] === "X" &&matrix[1][1] === "X" && matrix[1][2] === "X") {
    return "X";
  } 
  else if (matrix[2][0] === "X" &&matrix[2][1] === "X" && matrix[2][2] === "X") {
    return "X";
  }
  else if (matrix[0][0] === "X" &&matrix[1][0] === "X" && matrix[2][0] === "X") {
    return "X";
  }
  else if (matrix[0][1] === "X" &&matrix[1][1] === "X" && matrix[2][1] === "X") {
    return "X";
  }
  else if (matrix[0][2] === "X" &&matrix[1][2] === "X" && matrix[2][2] === "X") {
    return "X";
  }
  else if (matrix[0][0] === "X" &&matrix[1][1] === "X" && matrix[2][2] === "X") {
    return "X";
  }
  else if (matrix[0][2] === "X" &&matrix[1][1] === "X" && matrix[2][0] === "X") {
    return "X";
  }
  else if (matrix[0][0] === "O" &&matrix[0][1] === "O" && matrix[0][2] === "O") {
    return "O";
  }
  else if (matrix[1][0] === "O" &&matrix[1][1] === "O" && matrix[1][2] === "O") {
    return "O";
  } 
  else if (matrix[2][0] === "O" &&matrix[2][1] === "O" && matrix[2][2] === "O") {
    return "O";
  }
  else if (matrix[0][0] === "O" &&matrix[1][0] === "O" && matrix[2][0] === "O") {
    return "O";
  }
  else if (matrix[0][1] === "O" &&matrix[1][1] === "O" && matrix[2][1] === "O") {
    return "O";
  }
  else if (matrix[0][2] === "O" &&matrix[1][2] === "O" && matrix[2][2] === "O") {
    return "O";
  }
  else if (matrix[0][0] === "O" &&matrix[1][1] === "O" && matrix[2][2] === "O") {
    return "O";
  }
  else if (matrix[0][2] === "O" &&matrix[1][1] === "O" && matrix[2][0] === "O") {
    return "O";
  }
  else {
    return false;
  }
}

function clearbutton () {
  var button = document.getElementById("resetButton");
  button.addEventListener('click', clearSquares);
}
clearbutton();

function clearSquares () {
  var squares = document.getElementsByClassName("square");
  for (var i=0; i<squares.length; i++) {
      squares[i].style.background = 'white';
  }
  for(var i=0; i<3; i++) {
    matrix[i] = [];
    for(var j=0; j<3; j++) {
        matrix[i][j] = "";
    }
  }
  player = "X";
  for (i=0; i<squares.length; i++) {
    squares[i].setAttribute("style", "background-image: url(images/civil-war.jpg");
  }
  var playerTurn = document.getElementById("player");
  playerTurn.textContent = "It's Captain America's turn";
  var scoreboard = document.getElementById("scoreboard");
  scoreboard.textContent = winnerX + " - " + winnerO;
  squareClicked();
}

</script>

</html>
